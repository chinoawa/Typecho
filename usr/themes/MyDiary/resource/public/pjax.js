(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Pjax=c()})(function(){return function(){function c(d,f,g){function e(a,l){if(!f[a]){if(!d[a]){var m="function"==typeof require&&require;if(!l&&m)return m(a,!0);if(b)return b(a,!0);m=Error("Cannot find module '"+a+"'");throw m.code="MODULE_NOT_FOUND",m;}m=f[a]={exports:{}};d[a][0].call(m.exports,function(b){return e(d[a][1][b]||b)},m,m.exports,c,d,f,g)}return f[a].exports}for(var b="function"==typeof require&&require,h=0;h<g.length;h++)e(g[h]);return e}return c}()({1:[function(c,d,f){var g=c("./lib/execute-scripts"),e=c("./lib/foreach-els"),b=c("./lib/parse-options");f=c("./lib/switches");var h=c("./lib/uniqueid"),a=c("./lib/events/on"),l=c("./lib/events/trigger"),m=c("./lib/util/clone"),v=c("./lib/util/contains"),k=c("./lib/util/extend"),r=c("./lib/util/noop"),q=function(e){this.state={numPendingSwitches:0,href:null,options:null};this.options=b(e);this.log("Pjax options",this.options);this.options.scrollRestoration&&"scrollRestoration"in history&&(history.scrollRestoration="manual");this.maxUid=this.lastUid=h();this.parseDOM(document);a(window,"popstate",function(a){if(a.state){var b=m(this.options);b.url=a.state.url;b.title=a.state.title;b.history=!1;b.scrollPos=a.state.scrollPos;a.state.uid<this.lastUid?b.backward=!0:b.forward=!0;this.lastUid=a.state.uid;this.loadUrl(a.state.url,b)}}.bind(this))};q.switches=f;q.prototype={log:c("./lib/proto/log"),getElements:function(a){return a.querySelectorAll(this.options.elements)},parseDOM:function(a){var b=c("./lib/proto/parse-element");e(this.getElements(a),b,this)},refresh:function(a){this.parseDOM(a||document)},reload:function(){window.location.reload()},attachLink:c("./lib/proto/attach-link"),attachForm:c("./lib/proto/attach-form"),forEachSelectors:function(a,b,e){return c("./lib/foreach-selectors").bind(this)(this.options.selectors,a,b,e)},switchSelectors:function(a,b,e,g){return c("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,a,b,e,g)},latestChance:function(a){window.location=a},onSwitch:function(){l(window,"resize scroll");this.state.numPendingSwitches--;0===this.state.numPendingSwitches&&this.afterAllSwitches()},loadContent:function(a,b){if("string"!==typeof a)l(document,"pjax:complete pjax:error",b);else{var e=document.implementation.createHTMLDocument("pjax"),g=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi,c=a.match(/<html[^>]+>/gi);c&&c.length&&(c=c[0].match(g),c.length&&(c.shift(),c.forEach(function(a){a=a.trim().split("\x3d");1===a.length?e.documentElement.setAttribute(a[0],!0):e.documentElement.setAttribute(a[0],a[1].slice(1,-1))})));e.documentElement.innerHTML=a;this.log("load content",e.documentElement.attributes,e.documentElement.innerHTML.length);if(document.activeElement&&v(document,this.options.selectors,document.activeElement))try{document.activeElement.blur()}catch(x){}this.switchSelectors(this.options.selectors,e,document,b)}},abortRequest:c("./lib/abort-request"),doRequest:c("./lib/send-request"),handleResponse:c("./lib/proto/handle-response"),loadUrl:function(a,b){b="object"===typeof b?k({},this.options,b):m(this.options);this.log("load href",a,b);this.abortRequest(this.request);l(document,"pjax:send",b);this.request=this.doRequest(a,b,this.handleResponse.bind(this))},afterAllSwitches:function(){var a=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();a&&document.activeElement!==a&&a.focus();this.options.selectors.forEach(function(a){e(document.querySelectorAll(a),function(a){g(a)})});a=this.state;a.options.history&&(window.history.state||(this.lastUid=this.maxUid=h(),window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)),this.lastUid=this.maxUid=h(),window.history.pushState({url:a.href,title:a.options.title,uid:this.maxUid,scrollPos:[0,0]},a.options.title,a.href));this.forEachSelectors(function(a){this.parseDOM(a)},this);l(document,"pjax:complete pjax:success",a.options);"function"===typeof a.options.analytics&&a.options.analytics();if(a.options.history){var b=document.createElement("a");b.href=this.state.href;if(b.hash){b=b.hash.slice(1);b=decodeURIComponent(b);a=0;if((b=document.getElementById(b)||document.getElementsByName(b)[0])&&b.offsetParent){do a+=b.offsetTop,b=b.offsetParent;while(b)}window.scrollTo(0,a)}else!1!==a.options.scrollTo&&(1<a.options.scrollTo.length?window.scrollTo(a.options.scrollTo[0],a.options.scrollTo[1]):window.scrollTo(0,a.options.scrollTo))}else a.options.scrollRestoration&&a.options.scrollPos&&window.scrollTo(a.options.scrollPos[0],a.options.scrollPos[1]);this.state={numPendingSwitches:0,href:null,options:null}}};q.isSupported=c("./lib/is-supported");if(q.isSupported())d.exports=q;else{for(var p in q.prototype)q.prototype.hasOwnProperty(p)&&"function"===typeof q.prototype[p]&&(r[p]=r);d.exports=r}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(c,d,f){var g=c("./util/noop");d.exports=function(e){e&&4>e.readyState&&(e.onreadystatechange=g,e.abort())}},{"./util/noop":23}],3:[function(c,d,f){d.exports=function(c){var e=c.text||c.textContent||c.innerHTML||"",b=c.src||"",g=c.parentNode||document.querySelector("head")||document.documentElement,a=document.createElement("script");if(e.match("document.write"))return console&&console.log&&console.log("Script contains document.write. Can\u2019t be executed correctly. Code skipped ",c),!1;a.type="text/javascript";a.id=c.id;""!==b&&(a.src=b,a.async=!1);if(""!==e)try{a.appendChild(document.createTextNode(e))}catch(l){a.text=e}g.appendChild(a);(g instanceof HTMLHeadElement||g instanceof HTMLBodyElement)&&g.contains(a)&&g.removeChild(a);return!0}},{}],4:[function(c,d,f){var g=c("../foreach-els");d.exports=function(e,b,c,a){b="string"===typeof b?b.split(" "):b;b.forEach(function(b){g(e,function(e){e.addEventListener(b,c,a)})})}},{"../foreach-els":7}],5:[function(c,d,f){var g=c("../foreach-els");d.exports=function(e,b,c){b="string"===typeof b?b.split(" "):b;b.forEach(function(a){var b;b=document.createEvent("HTMLEvents");b.initEvent(a,!0,!0);b.eventName=a;c&&Object.keys(c).forEach(function(a){b[a]=c[a]});g(e,function(a){var e=!1;a.parentNode||a===document||a===window||(e=!0,document.body.appendChild(a));a.dispatchEvent(b);e&&a.parentNode.removeChild(a)})})}},{"../foreach-els":7}],6:[function(c,d,f){var g=c("./foreach-els"),e=c("./eval-script");d.exports=function(b){"script"===b.tagName.toLowerCase()&&e(b);g(b.querySelectorAll("script"),function(b){b.type&&"text/javascript"!==b.type.toLowerCase()||(b.parentNode&&b.parentNode.removeChild(b),e(b))})}},{"./eval-script":3,"./foreach-els":7}],7:[function(c,d,f){d.exports=function(c,e,b){return c instanceof HTMLCollection||c instanceof NodeList||c instanceof Array?Array.prototype.forEach.call(c,e,b):e.call(b,c)}},{}],8:[function(c,d,f){var g=c("./foreach-els");d.exports=function(e,b,c,a){a=a||document;e.forEach(function(e){g(a.querySelectorAll(e),b,c)})}},{"./foreach-els":7}],9:[function(c,d,f){d.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],10:[function(c,d,f){function g(){window._gaq&&_gaq.push(["_trackPageview"]);window.ga&&ga("send","pageview",{page:location.pathname,title:document.title})}var e=c("./switches");d.exports=function(b){b=b||{};b.elements=b.elements||"a[href], form[action]";b.selectors=b.selectors||["title",".js-Pjax"];b.switches=b.switches||{};b.switchesOptions=b.switchesOptions||{};b.history="undefined"===typeof b.history?!0:b.history;b.analytics="function"===typeof b.analytics||!1===b.analytics?b.analytics:g;b.scrollTo="undefined"===typeof b.scrollTo?0:b.scrollTo;b.scrollRestoration="undefined"!==typeof b.scrollRestoration?b.scrollRestoration:!0;b.cacheBust="undefined"===typeof b.cacheBust?!0:b.cacheBust;b.debug=b.debug||!1;b.timeout=b.timeout||0;b.currentUrlFullReload="undefined"===typeof b.currentUrlFullReload?!1:b.currentUrlFullReload;b.switches.head||(b.switches.head=e.switchElementsAlt);b.switches.body||(b.switches.body=e.switchElementsAlt);return b}},{"./switches":18}],11:[function(c,d,f){function g(a,b){if(a.protocol!==window.location.protocol||a.host!==window.location.host)return"external";if(a.hash&&a.href.replace(a.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(a.href===window.location.href.split("#")[0]+"#")return"anchor-empty";if(b.currentUrlFullReload&&a.href===window.location.href.split("#")[0])return"reload"}var e=c("../events/on"),b=c("../util/clone"),h=function(a,e){if(!e.defaultPrevented&&!1!==e.returnValue){var c=b(this.options);c.requestOptions={requestUrl:a.getAttribute("action")||window.location.href,requestMethod:a.getAttribute("method")||"GET"};var d=document.createElement("a");d.setAttribute("href",c.requestOptions.requestUrl);var l=g(d,c);if(l)a.setAttribute("data-pjax-state",l);else{e.preventDefault();if("multipart/form-data"===a.enctype)c.requestOptions.formData=new FormData(a);else{for(var l=c.requestOptions,h=[],f=a.elements,p=0;p<f.length;p++){var t=f[p],n=t.tagName.toLowerCase();if(t.name&&void 0!==t.attributes&&"button"!==n){var u=t.attributes.type;if(!u||"checkbox"!==u.value&&"radio"!==u.value||t.checked){u=[];if("select"===n)for(var w=0;w<t.options.length;w++)n=t.options[w],n.selected&&!n.disabled&&u.push(n.hasAttribute("value")?n.value:n.text);else u.push(t.value);for(n=0;n<u.length;n++)h.push({name:encodeURIComponent(t.name),value:encodeURIComponent(u[n])})}}}l.requestParams=h}a.setAttribute("data-pjax-state","submit");c.triggerElement=a;this.loadUrl(d.href,c)}}};d.exports=function(a){var b=this;a.setAttribute("data-pjax-state","");e(a,"submit",function(c){h.call(b,a,c)})}},{"../events/on":4,"../util/clone":20}],12:[function(c,d,f){function g(a,b){if(1<b.which||b.metaKey||b.ctrlKey||b.shiftKey||b.altKey)return"modifier";if(a.protocol!==window.location.protocol||a.host!==window.location.host)return"external";if(a.hash&&a.href.replace(a.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(a.href===window.location.href.split("#")[0]+"#")return"anchor-empty"}var e=c("../events/on"),b=c("../util/clone"),h=function(a,c){if(!c.defaultPrevented&&!1!==c.returnValue){var e=b(this.options),d=g(a,c);d?a.setAttribute("data-pjax-state",d):(c.preventDefault(),this.options.currentUrlFullReload&&a.href===window.location.href.split("#")[0]?(a.setAttribute("data-pjax-state","reload"),this.reload()):(a.setAttribute("data-pjax-state","load"),e.triggerElement=a,this.loadUrl(a.href,e)))}};d.exports=function(a){var b=this;a.setAttribute("data-pjax-state","");e(a,"click",function(c){h.call(b,a,c)});e(a,"keyup",function(c){13===c.keyCode&&h.call(b,a,c)}.bind(this))}},{"../events/on":4,"../util/clone":20}],13:[function(c,d,f){var g=c("../util/clone"),e=c("../uniqueid"),b=c("../events/trigger");d.exports=function(c,a,d,f){f=g(f||this.options);f.request=a;if(!1===c)b(document,"pjax:complete pjax:error",f);else{var h=window.history.state||{};window.history.replaceState({url:h.url||window.location.href,title:h.title||document.title,uid:h.uid||e(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);h=d;a.responseURL?d!==a.responseURL&&(d=a.responseURL):a.getResponseHeader("X-PJAX-URL")?d=a.getResponseHeader("X-PJAX-URL"):a.getResponseHeader("X-XHR-Redirected-To")&&(d=a.getResponseHeader("X-XHR-Redirected-To"));a=document.createElement("a");a.href=h;h=a.hash;a.href=d;h&&!a.hash&&(a.hash=h,d=a.href);this.state.href=d;this.state.options=f;try{this.loadContent(c,f)}catch(k){b(document,"pjax:error",f);if(this.options.debug)throw k;console&&console.error&&console.error("Pjax switch fail: ",k);return this.latestChance(d)}}}},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(c,d,f){d.exports=function(){this.options.debug&&console&&("function"===typeof console.log?console.log.apply(console,arguments):console.log&&console.log(arguments))}},{}],15:[function(c,d,f){d.exports=function(c){switch(c.tagName.toLowerCase()){case "a":c.hasAttribute("data-pjax-state")||this.attachLink(c);break;case "form":c.hasAttribute("data-pjax-state")||this.attachForm(c);break;default:throw"Pjax can only be applied on \x3ca\x3e or \x3cform\x3e submit";}}},{}],16:[function(c,d,f){var g=c("./util/update-query-string");d.exports=function(c,b,d){b=b||{};var a,e=b.requestOptions||{},h=(e.requestMethod||"GET").toUpperCase();a=e.requestParams||null;var e=e.formData||null,f=null,k=new XMLHttpRequest,r=b.timeout||0;k.onreadystatechange=function(){4===k.readyState&&(200===k.status?d(k.responseText,k,c,b):0!==k.status&&d(null,k,c,b))};k.onerror=function(a){console.log(a);d(null,k,c,b)};k.ontimeout=function(){d(null,k,c,b)};if(a&&a.length)switch(a=a.map(function(a){return a.name+"\x3d"+a.value}).join("\x26"),h){case "GET":c=c.split("?")[0];c+="?"+a;break;case "POST":f=a}else e&&(f=e);b.cacheBust&&(c=g(c,"t",Date.now()));k.open(h,c,!0);k.timeout=r;k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.setRequestHeader("X-PJAX","true");k.setRequestHeader("X-PJAX-Selectors",JSON.stringify(b.selectors));f&&"POST"===h&&!e&&k.setRequestHeader("Content-Type","application/x-www-form-urlencoded");k.send(f);return k}},{"./util/update-query-string":24}],17:[function(c,d,f){var g=c("./foreach-els"),e=c("./switches");d.exports=function(b,c,a,d,f,v){var h=[];a.forEach(function(a){var k=d.querySelectorAll(a),p=f.querySelectorAll(a);this.log&&this.log("Pjax switch",a,k,p);if(k.length!==p.length)throw"DOM doesn\u2019t look the same on new loaded page: \u2019"+a+"\u2019 - new "+k.length+", old "+p.length;g(k,function(d,g){var f=p[g];this.log&&this.log("newEl",d,"oldEl",f);f=b[a]?b[a].bind(this,f,d,v,c[a]):e.outerHTML.bind(this,f,d,v);h.push(f)},this)},this);this.state.numPendingSwitches=h.length;h.forEach(function(a){a()})}},{"./foreach-els":7,"./switches":18}],18:[function(c,d,f){var g=c("./events/on");d.exports={outerHTML:function(c,b){c.outerHTML=b.outerHTML;this.onSwitch()},innerHTML:function(c,b){c.innerHTML=b.innerHTML;""===b.className?c.removeAttribute("class"):c.className=b.className;this.onSwitch()},switchElementsAlt:function(c,b){c.innerHTML=b.innerHTML;if(b.hasAttributes())for(var e=b.attributes,a=0;a<e.length;a++)c.attributes.setNamedItem(e[a].cloneNode());this.onSwitch()},replaceNode:function(c,b){c.parentNode.replaceChild(b,c);this.onSwitch()},sideBySide:function(c,b,d,a){var e=Array.prototype.forEach,f=[],h=[],k=document.createDocumentFragment(),r=0,q=function(a){a.target===a.currentTarget&&(r--,0>=r&&f&&(f.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),h.forEach(function(a){a.className=a.className.replace(a.getAttribute("data-pjax-classes"),"");a.removeAttribute("data-pjax-classes")}),f=h=null,this.onSwitch()))}.bind(this);a=a||{};e.call(c.childNodes,function(b){f.push(b);b.classList&&!b.classList.contains("js-Pjax-remove")&&(b.hasAttribute("data-pjax-classes")&&(b.className=b.className.replace(b.getAttribute("data-pjax-classes"),""),b.removeAttribute("data-pjax-classes")),b.classList.add("js-Pjax-remove"),a.callbacks&&a.callbacks.removeElement&&a.callbacks.removeElement(b),a.classNames&&(b.className+=" "+a.classNames.remove+" "+(d.backward?a.classNames.backward:a.classNames.forward)),r++,g(b,"animationend webkitAnimationEnd MSAnimationEnd oanimationend",q,!0))});e.call(b.childNodes,function(b){if(b.classList){var c="";a.classNames&&(c=" js-Pjax-add "+a.classNames.add+" "+(d.backward?a.classNames.forward:a.classNames.backward));a.callbacks&&a.callbacks.addElement&&a.callbacks.addElement(b);b.className+=c;b.setAttribute("data-pjax-classes",c);h.push(b);k.appendChild(b);r++;g(b,"animationend webkitAnimationEnd MSAnimationEnd oanimationend",q,!0)}});c.className=b.className;c.appendChild(k)}}},{"./events/on":4}],19:[function(c,d,f){d.exports=function(){var c=0;return function(){var e="pjax"+(new Date).getTime()+"_"+c;c++;return e}}()},{}],20:[function(c,d,f){d.exports=function(c){if(null===c||"object"!==typeof c)return c;var e=c.constructor(),b;for(b in c)c.hasOwnProperty(b)&&(e[b]=c[b]);return e}},{}],21:[function(c,d,f){d.exports=function(c,e,b){for(var d=0;d<e.length;d++)for(var a=c.querySelectorAll(e[d]),f=0;f<a.length;f++)if(a[f].contains(b))return!0;return!1}},{}],22:[function(c,d,f){d.exports=function(c){if(null==c)return null;for(var e=Object(c),b=1;b<arguments.length;b++){var d=arguments[b];if(null!=d)for(var a in d)Object.prototype.hasOwnProperty.call(d,a)&&(e[a]=d[a])}return e}},{}],23:[function(c,d,f){d.exports=function(){}},{}],24:[function(c,d,f){d.exports=function(c,e,b){var d=new RegExp("([?\x26])"+e+"\x3d.*?(\x26|$)","i"),a=-1!==c.indexOf("?")?"\x26":"?";return c.match(d)?c.replace(d,"$1"+e+"\x3d"+b+"$2"):c+a+e+"\x3d"+b}},{}]},{},[1])(1)});